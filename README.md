# Telegram Chat Analyzer Userbot

## Инструкция по установке и использованию

### Требования
- Python 3.13.2
- Библиотека Pyrogram
- Аккаунт Telegram

### Установка

1. **Установите Python 3.13.2**
   - Скачайте и установите Python 3.13.2 с [официального сайта](https://www.python.org/downloads/)
   - Убедитесь, что Python установлен правильно:
     ```bash
     python --version
     # или
     python3 --version
     ```

2. **Создайте виртуальное окружение (рекомендуется)**
   ```bash
   python -m venv venv
   # или
   python3 -m venv venv
   ```

3. **Активируйте виртуальное окружение**
   - **Windows:**
     ```bash
     venv\Scripts\activate
     ```
   - **Linux/macOS:**
     ```bash
     source venv/bin/activate
     ```

4. **Установите зависимости**
   ```bash
   pip install -r requirements.txt
   ```

### Подготовка к использованию

1. **Получите API ID и API Hash**
   - Зайдите на [https://my.telegram.org](https://my.telegram.org)
   - Авторизуйтесь с вашим Telegram аккаунтом
   - Создайте новое приложение (App)
   - Запишите `api_id` и `api_hash`

2. **Настройка переменных окружения**
   Создайте файл `.env` в папке с проектом:
   ```
   API_ID=ваш_api_id
   API_HASH=ваш_api_hash
   ```

### Запуск

#### Интерактивный режим (без аргументов)
```bash
python main.py
```
- Программа покажет список доступных чатов, сгруппированных по типам
- Выберите нужный чат по ID
- Программа автоматически начнет анализ
- При необходимости укажите период анализа в формате `день.месяц.год` (например: `1.1.2023`)

#### Режим с аргументами
```bash
python main.py --chat_id -1001234567890 --start_date 1.1.2023 --end_date 31.12.2023 --db_path my_chat.db --output results.txt
```

**Доступные аргументы:**
- `--chat_id` - ID чата для анализа (если не указан, запускается интерактивный режим)
- `--start_date` - начальная дата в формате день.месяц.год (например: 1.1.2023)
- `--end_date` - конечная дата в формате день.месяц.год (например: 31.12.2023)
- `--db_path` - путь к файлу базы данных (по умолчанию: `chat_data.db`)
- `--output` - путь к файлу результатов (по умолчанию: `results.txt`)

### Функциональность

Программа анализирует следующие метрики:

#### Глобальная статистика:
1. Общее количество сообщений
2. Топ-10 самых популярных слов (без стоп-слов)
3. Топ-5 самых популярных стикеров (с эмодзи и ссылками на стикерпаки)
4. Самый активный день (учитываются только текстовые сообщения, без фото и видео)
5. Количество дней без активности
6. Общее количество голосовых/видеосообщений
7. Самый активный участник по сообщениям
8. Самый активный по голосовым
9. Самый активный по фото/видео
10. Самый активный по словам
11. Самый активный по стикерам
12. Месяцы по активности
13. Популярные слова по месяцам
14. Самые активные участники по месяцам

#### Статистика по пользователям:
1. Общее количество сообщений
2. Топ-10 слов
3. Самый популярный стикер
4. Самый активный день (учитываются только текстовые сообщения, без фото и видео)
5. Количество дней без активности
6. Количество голосовых
7. Месяцы по активности

### Структура результатов

- **Группировка чатов:** каналы, группы, личные чаты, без названия
- **Сортировка:** по дате последнего сообщения (новые первыми)
- **Результаты:** сохраняются в текстовый файл с подробной статистикой
- **Стикеры:** отображаются с эмодзи и прямой ссылкой для добавления стикерпака
- **Фильтрация стоп-слов:** русские и английские предлоги, союзы и другие незначимые слова исключаются из анализа
- **Часовые пояса:** все даты обрабатываются с учетом UTC

### Особенности

- **Анализ за период:** можно указать начальную и конечную дату для анализа
- **Производительность:** оптимизирована для работы с большими чатами (до 100k+ сообщений)
- **Обработка ошибок:** включает проверку доступа к чату и обработку флуд-ограничений
- **Анализ только активных пользователей:** в отчет попадают только те, кто отправил хотя бы одно сообщение

### Файлы

- `main.py` - основной скрипт
- `chat_{id}.db` - база данных SQLite (создается автоматически)
- `analysis_{id}_{datetime}.txt` - файл с результатами анализа

### Безопасность

- Программа использует сессии Pyrogram для аутентификации
- Данные хранятся локально в SQLite базе
- Не отправляет данные на сторонние серверы

### Поддержка

Если возникли проблемы:
1. Убедитесь, что используется Python 3.13.2
2. Проверьте корректность API ID и API Hash
3. Убедитесь в наличии доступа к анализируемому чату